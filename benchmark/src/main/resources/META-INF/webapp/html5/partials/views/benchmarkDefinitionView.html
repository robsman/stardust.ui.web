
<div class="view-panel" 
     ng-controller="benchmarkCtrl as ctrl"
	 sg-stretch-to-bottom>
	
	<i style="position:absolute;" 
	   ng-click="ctrl.showBenchmarks = !ctrl.showBenchmarks" 
	   ng-class="{'sc-arrow-d': ctrl.showBenchmarks,'sc-arrow-r': !ctrl.showBenchmarks}"
	   class="sc sc-fw sc-2x sc-arrow-d">
	</i>
	<span style="margin:2em;" class="header">Benchmark Definitions</span>
	
	<!-- Data Table for Benchmarks -->
	<div ng-show="ctrl.showBenchmarks">
	
		<select ng-model="ctrl.benchmarkFilter" ng-change="ctrl.loadBenchmarks(ctrl.benchmarkFilter)">
			<option selected value="Design">Designs</option>
			<option value="Published">Published</option>
		</select>
		
		<div sda-toolbar>
		    <a href="#" ng-click="ctrl.createBenchmark()" title="Add Benchmark" class="tbl-toolbar-item tbl-tool-link">
		       <i class="glyphicon glyphicon-plus">Add</i>
		    </a>
		</div>
		
		<table sd-data-table="ctrl.dataTableApi"
			   sda-mode="local"
			   sda-selectable="row"
			   sda-page-size = "5"
			   sda-on-select="ctrl.benchmarkSelected(d)"
			   sd-data ="ctrl.benchmarks">
			   <thead>
				   	<tr>
				   		<th sda-name="name" sda-label="Name"></th>
				   		<th sda-name="description" sda-label="Description"></th>
				   		<th sda-name="modifiedBy" sda-label="Modified By"></th>
				   		<th sda-name="lastModified" sda-label="Last Modified"></th>
				   	</tr>
			   </thead>
			   <tbody>
			   		<tr>
			   			<td sda-field="benchmark.name"></td>
			   			<td sda-field="benchmark.description"></td>
			   			<td sda-field="meta.modifiedBy"></td>
			   			<td sda-field="meta.lastModified"></td>
			   		</tr>
			   </tbody>
		</table>
	</div>
	
	<!-- Display for currently selected benchmark -->
	<div ng-show="ctrl.selectedBenchmark">
		<div>
			<span style="font-size:12px;" class="header">{{ctrl.selectedBenchmark.name}}</span>
		</div>
		<div>
			<i class="sc sc-clock"></i> 
			<span>Last Saved {{ctrl.getLastSaveTime()}}</span>
		</div>
		<div>
			<i ng-class="{'glyphicon-floppy-disk' : ctrl.benchmarkIsDirty,'glyphicon-floppy-saved' : !ctrl.benchmarkIsDirty}" 
			   ng-click="saveBenchmarks()"
			   class="glyphicon">
			</i>
			<i class="glyphicon glyphicon-remove"></i>
		</div>
	</div>
	
	<!--Bottom Container - Tabs - > Model Tree and Categories  -->
	<div style="width:100%;position:relative;margin-top:1em;">
		
	    <!-- Tabs -->
	    <div style="width:100%;border-bottom:solid 1px #ddd;position:relative;">
	    
		    <div class="tab"
		    	 ng-class="{selected: ctrl.selectedTab==='General'}"
		    	 ng-click="ctrl.selectedTab = 'General'">
		    	 <span class="header">General</span>
		    	 <div class="tab-arrow" ng-show="ctrl.selectedTab === 'General'"></div>
		    </div>
		    
		    <div class="tab"
		    	 ng-class="{selected: ctrl.selectedTab === 'Categories'}"
		    	 ng-click="ctrl.selectedTab ='Categories'">
		    	 <span class="header">Categories</span>
		    	 <div class="tab-arrow" ng-show="ctrl.selectedTab === 'Categories'"></div>
		    </div>
		    
	    </div>
	    
	    <div ng-show="ctrl.selectedTab ==='Categories'">
	    
		    <!-- Model Tree Container -->
			<div style="width:225px;display:inline-table;">
			
				<!-- sdTree Implementation of Model Tree -->
			    <ul sd-tree="ctrl.onTreeInit(api)"
			       	sda-event-callback="ctrl.treeCallback(data,e)"
			       	sda-icon-callback="ctrl.iconCallback(item)"
			       	sda-menu-callback="ctrl.menuCallback(item)">
			      <li sd-tree-node 
			          sda-is-leaf = "model.processDefinitions.length == 0"
			          sda-label="model.name" 
			          sda-node-id="model.nodeId" 
			          ng-repeat="model in ctrl.models">
			        <ul>
			          <li sd-tree-node
			              sda-is-leaf="process.activities.length==0"
			              sda-label="process.name"
			              sda-node-id="process.nodeId"
			              ng-repeat="process in model.processDefinitions">
			            <ul>
			              <li sd-tree-node
			                  sda-is-leaf="true"
			                  sda-draggable="true"
			                  sda-label="activity.name"
			                  sda-menu-items="(start,Start Activity),(suspend,Suspend Activity)"
			                  sda-node-id="activity.nodeId"
			                  ng-repeat="activity in process.activities">
			              </li><!-- activity structure ends -->
			            </ul>
			          </li><!-- process structure ends -->
			        </ul>
			      </li><!-- model structure ends -->
			    </ul>
			    
		    </div>
		    
		    <!-- Categories Table-->
		    <div style="width:calc(100% - 230px);display:inline-table;">
		    
		    	<table class="tbl ng-scope dataTable" id="benchmarkTable" style="width:100%;">
		    	<colgroup>
			       <col span="1" style="width: 5%;">
			       <col span="1" style="width: 15%;">
			    </colgroup>
		    		<thead>
		    			<th class="tbl-hdr-col">
		    				<span class="tbl-hdr-col-label">Element</span>
		    			</th>
		    			<th class="tbl-hdr-col">
		    				<span class="tbl-hdr-col-label">Options</span>
		    			</th>
		    			<th class="tbl-hdr-col" ng-repeat="category in ctrl.selectedBenchmark.categories">
		    				<span class="tbl-hdr-col-label">{{category.name}}</span>
		    				<div style="display:inline-block;background-color:{{category.color}};width:25px;">&nbsp;</div>
		    			</th>
		    		</thead>
		    		<tbody>
		    			<tr ng-class-even="even" class="tbl-row" ng-repeat="data in ctrl.benchmarkDataRows">
		    				<td style="vertical-align:top;">
			    				<a href="#" title="{{data.breadCrumbs.join('&#x2F;')}}">
			    					{{data.breadCrumbs[data.breadCrumbs.length-1]}}
			    				</a>
		    				</td>
		    				<td style="vertical-align:top;">
		    					<label>
		    						<input ng-model="data.enableBenchmark" type="checkbox"/>No Benchmark
		    					</label>
		    					<label ng-show="data.element==='Process Definition'">
		    						<input ng-model="data.dueDate.enabled" type="checkbox"/>
		    						Enable Due Date
		    					</label>
		    					<div ng-show="data.dueDate.enabled">
		    					
		    						<label>Reference
		    							<select style="width:60%;" ng-model="data.dueDate.dateReference">
		    								<option value="businessDate">Business Date3</option>
		    							</select>
		    						</label>
		    						
		    						<label style="display:inline-table;">
			    					<input ng-model="data.dueDate.offset.useBusinessDays" 
					    				   value="true" 
					    				   name="{{data.nodePath}}{{$index}}dd_ubd"
					    				   type="radio"/>
					    				   Business Days
			    					</label>
			    				
				    				<label style="display:inline-table;">
				    					<input ng-model ="data.dueDate.offset.useBusinessDays" 
				    					       name="{{data.nodePath}}{{$index}}dd_ubd" 
				    					       value="false" 
				    					       type="radio"/>
				    					       Calendar Days
				    				</label>
				    				
			    					<label>
			    						<input ng-model="data.dueDate.offset.applyOffset" type="checkbox"/>
			    						Apply Offset
			    					</label>
			    					
			    					<input style="width:40px;"
			    					       ng-model="data.dueDate.offset.amount" type="number"/>
			    					
			    					<select style="width:calc(100% - 55px);" ng-model="data.dueDate.offset.unit">
			    						<option value="d">Days</option>
			    						<option value="w">Weeks</option>
			    						<option value="m">Months</option>
			    					</select>
			    					
			    					<label>At 
			    						<input type="time" ng-model="data.dueDate.offset.offsetTime"/>
			    					</label>
		    						
		    						
		    					</div>
		    					<!-- pre>{{data | json}}</pre-->
		    				</td>
		    				<td ng-repeat="catInst in data.categoryConditions | orderBy:getCategoryPosition">
		    				
		    					<select ng-model="catInst.details.condition.lhs">
		    						<option value="Default">Default</option>
		    						<option value="FreeForm">Free-Form</option>
		    						<option value="CurrentTime">Current Time</option>
		    					</select>
		    					
		    					<div ng-show="catInst.details.condition.lhs==='FreeForm'">
		    						<textarea ng-model="catInst.freeFormExpression" rows="" cols=""></textarea>
		    					</div>
		    					
		    					<div ng-show="catInst.details.condition.lhs==='CurrentTime'">
		    					
			    					<select ng-model="catInst.details.condition.operator">
			    						<option value="!LaterThan">Not Later Than</option>
			    						<option value="LaterThan">Later Than</option>
			    					</select>
			    					
			    					<select ng-model="catInst.details.condition.rhs">
			    						<option value="PrimitiveData">TODO: Get Primitive Data</option>
			    					</select>
			    					
			    					<p></p>
			    					
				    				<label style="display:inline-table;">
				    					<input ng-model="catInst.details.condition.offset.useBusinessDays" 
						    				   value="true" 
						    				   name="{{data.nodePath}}{{$index}}ubd"
						    				   type="radio"/>
						    				   Business Days
				    				</label>
				    				
				    				<label style="display:inline-table;">
				    					<input ng-model ="catInst.details.condition.offset.useBusinessDays" 
				    					       name="{{data.nodePath}}{{$index}}ubd" 
				    					       value="false" 
				    					       type="radio"/>
				    					       Calendar Days
				    				</label>
				    				
			    					<label>
			    						<input ng-model="catInst.details.condition.offset.applyOffset" type="checkbox"/>
			    						Apply Offset
			    					</label>
			    					
			    					<input style="padding-right" ng-model="catInst.details.condition.offset.amount" type="number"/>
			    					
			    					<select ng-model="catInst.details.condition.offset.unit">
			    						<option value="d">Days</option>
			    						<option value="w">Weeks</option>
			    						<option value="m">Months</option>
			    					</select>
			    					
			    					<label>At 
			    						<input type="time" ng-model="catInst.details.condition.offset.offsetTime"/>
			    					</label>
		    					
								</div>
		    				</td>
		    			</tr>
		    		</tbody>
		    	</table>
		    	<!--pre>{{ctrl.benchmarkDataRows | json}}</pre-->
	    	</div>
	</div>
	
	<!-- General Elements of the Benchmark -->
	<div ng-show="ctrl.selectedTab ==='General'">
    	<label>Name</label> 
    	<input ng-disabled="!ctrl.selectedBenchmark" ng-model="ctrl.selectedBenchmark.name" type="text">
    	
    	<label>Description</label>
    	<textarea ng-disabled="!ctrl.selectedBenchmark" ng-model="ctrl.selectedBenchmark.description"></textarea>
    	
    	<label>Business Calendar</label>
    	<select ng-disabled="!ctrl.selectedBenchmark">
    		<option>TODO: Load Business Calendars</option>
    		<option>TODO: Load Even More Business Calendars</option>
    	</select>
    </div>
	
</div>

