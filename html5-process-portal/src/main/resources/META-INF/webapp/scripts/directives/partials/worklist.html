<div class="activity-table-wrapper">
	<div class="worklist-title tbl-title">{{activityTableCtrl.title}}</div>
	<div sda-toolbar>
		<div class="tbl-toolbar-section">
			<button ng-if="'worklist' === activityTableCtrl.mode " sda-column="TRIVIAL_DATA" ng-disabled="!activityTableCtrl.containsAllTrivialManualActivities()" ng-click="activityTableCtrl.$openCompleteDialog()" title="{{i18n('processportal.views-worklistPanel-tooltip-completeAll')}}" class="button-link tbl-toolbar-item tbl-tool-link">
			   <i class="glyphicon glyphicon-share-alt"></i>
			</button>
			<button ng-disabled="activityTableCtrl.dataTable.getSelection() < 1" href="#" ng-click="activityTableCtrl.$openDelegateDialog();" title="{{i18n('processportal.toolbars-worklistView-tooltip-delegate')}}" class="button-link tbl-toolbar-item tbl-tool-link" >
			   <i class="glyphicon glyphicon-user"></i>
			</button>
			<button ng-disabled="activityTableCtrl.dataTable.getSelection() < 1" ng-click="activityTableCtrl.$openAbortDialog(activityTableCtrl.dataTable.getSelection())" title="{{i18n('processportal.toolbars-worklistView-tooltip-abort')}}" class="button-link tbl-toolbar-item tbl-tool-link" style="margin-right: 0px;">
			   <i class="glyphicon glyphicon-remove"></i>
			</button>
			<button sd-abort-popover ng-disabled="activityTableCtrl.dataTable.getSelection() < 1" sda-activities="activityTableCtrl.dataTable.getSelection()" sda-on-confirm="activityTableCtrl.refresh()" class="button-link tbl-toolbar-item tbl-tool-link" style="padding-left: 0px;">
				<i class="glyphicon glyphicon-chevron-right glyphicon-rotate-90"></i>
			</button>
			<button ng-disabled="!activityTableCtrl.isPriorityChanged();" ng-if="activityTableCtrl.priorityEditable" ng-click="activityTableCtrl.savePriorityChanges();" class="button-link tbl-toolbar-item tbl-tool-link" style="padding-left: 0px;">
				<i class="glyphicon glyphicon-floppy-saved"></i>
			</button>
		</div>
	</div>
	<table sd-data-table="{{activityTableCtrl.tableHandleExpr}}" sd-data="activityTableCtrl.fetchPage(params)" sda-ready="activityTableCtrl.ready"
		sda-page-size="{{activityTableCtrl.sdaPageSize}}" sda-mode="remote"
		sda-selectable="multiple" sda-initial-selection="{{activityTableCtrl.initialSelection}}" sda-selection="{{activityTableCtrl.selectionExpr}}"
		sda-on-select="activityTableCtrl.onSelect(info)" sda-on-pagination="activityTableCtrl.onPagination(info)"
		sda-column-selector="{{activityTableCtrl.columnSelector}}" sda-preference-delegate="activityTableCtrl.preferenceDelegate(prefInfo)"
		sda-on-column-reorder="activityTableCtrl.onColumnReorder(info)"
		sda-sortable="true" sda-sort-by="{name : 'started', dir : 'desc'}" sda-on-sorting="activityTableCtrl.onSorting(info)"
		sda-exports="true" sda-exports-file-name="worklist-{{activityTableCtrl.exportFileName}}">
		<thead sda-i18n-scope="processportal.views-worklistPanel-column">
			<tr>
				<th sda-name="overview" sda-sortable="true" sda-visible="{{activityTableCtrl.isColumnVisible('overview')}}">
					<div sda-filter-template>
						<div sd-process-activity-filter sda-filter-type='activity' sda-processes="activityTableCtrl.allAccessibleProcesses"></div>
					</div>
				</th>
				<th sda-name="oid" sda-sortable="true" sda-filterable="true" sda-visible="{{activityTableCtrl.isColumnVisible('oid')}}"></th>
				<th sda-name="criticality" sda-sortable="true" sda-visible="{{activityTableCtrl.isColumnVisible('criticality')}}">
					<div sda-filter-template>
						<div sd-criticality-filter sda-criticalities="activityTableCtrl.allAvailableCriticalities"></div>
					</div>
				</th>
				<th sda-name="priority" sda-sortable="true" sda-visible="{{activityTableCtrl.isColumnVisible('priority')}}">
					<div sda-filter-template>
						<div sd-priority-filter></div>
					</div>
				</th>
				<th sda-name="descriptors" sda-sortable="false"  sda-visible="{{activityTableCtrl.isColumnVisible('descriptors')}}"></th>
				<th sda-name="started" sda-sortable="true" sda-filterable="true" sda-visible="{{activityTableCtrl.isColumnVisible('started')}}"></th>
				<th sda-name="lastModified" sda-label-key="lastmodification"
					sda-sortable="true" sda-filterable="true" sda-visible="{{activityTableCtrl.isColumnVisible('lastModified')}}"></th>
				<th sda-name="duration" sda-sortable="false" sda-filterable="false" sda-visible="{{activityTableCtrl.isColumnVisible('duration')}}"></th>
				<th sda-name="lastPerformer" sda-sortable="false" sda-filterable="false" sda-visible="{{activityTableCtrl.isColumnVisible('lastPerformer')}}"></th>
				<th sda-name="processDefinition" sda-label-key="processName" sda-visible="{{activityTableCtrl.isColumnVisible('processDefinition')}}"
					 sda-sortable="false">
					<div sda-filter-template>
						<div sd-process-activity-filter sda-filter-type='process' sda-processes="activityTableCtrl.allAccessibleProcesses"></div>
					</div>
				</th>
				<th sda-name="status" sda-sortable="false" sda-visible="{{activityTableCtrl.isColumnVisible('status')}}">
					<div sda-filter-template>
						<div sd-multi-select-filter sda-options="activityTableCtrl.availableStates"></div>
					</div>
				</th>
				<th sda-name="assignedTo" sda-sortable="false" sda-visible="{{activityTableCtrl.isColumnVisible('assignedTo')}}" sda-filterable="false"></th>
				<th ng-repeat="descCol in activityTableCtrl.descritorCols" sda-visible="{{activityTableCtrl.isColumnVisible('descritorCols')}}" sda-column="DESCRIPTOR_COLUMNS"
					sda-name="{{descCol.id}}" sda-label="{{descCol.title}}"
				    sda-sortable="{{descCol.sortable}}">
					<div sda-filter-template ng-if="descCol.filterable">
						<div ng-if="colData.dataType =='NUMBER'"><div sd-number-filter></div></div>
						<div ng-if="colData.dataType =='DATE'"><div sd-date-filter></div></div>
						<div ng-if="colData.dataType =='BOOLEAN'"><div sd-boolean-filter></div></div>
						<div ng-if="colData.dataType =='STRING'"><div sd-text-search-filter></div></div>
					</div>
				</th>
				<th sda-name="data" sda-column="TRIVIAL_DATA" sda-sortable="false" sda-exportable="false" sda-filterable="false" sda-visible="{{activityTableCtrl.isColumnVisible('data')}}"></th>
				<th sda-name="actions" sda-fixed="true" sda-exportable="false" sda-filterable="false"></th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td style="white-space: nowrap;" sda-exporter="rowData.activity.name" style="text-align: center;"">
					
					<div ng-if="activityTableCtrl.mode === 'worklist'">
						<a ng-if="rowData.activatable" href="#"
							ng-click="bpmCommon.stopEvent($event); activityTableCtrl.$activateItem(rowData);"
							title="{{i18n('processportal.views-worklistPanel-tooltip-openActivity')}}"
							class="button-link tbl-tool-link"> {{rowData.activity.name}}
						</a>
						 <span ng-if="!rowData.activatable"
							ng-bind="rowData.activity.name"> </span> <span
							ng-if="rowData.qualityAssuranceState"> <span
							ng-if="rowData.qualityAssuranceState ==='IS_REVISED'"> <i
								class="glyphicon glyphicon-remove-circle"
								style="color: red; margin-left: 2px;"></i></span> <span
							ng-if="rowData.qualityAssuranceState === 'IS_QUALITY_ASSURANCE'"><i
								class="glyphicon glyphicon-time" style="margin-left: 2px;"></i></span>
						</span>
					</div>
					<div ng-if="activityTableCtrl.mode === 'activityOverview'">
						<a  href="#"
							ng-click="bpmCommon.stopEvent($event); activityTableCtrl.$openProcessHistory(rowData);"
						title="{{i18n('processportal.toolbars-workflowActions-tooltip-processContextExplorer')}}"
							class="button-link tbl-tool-link"> {{rowData.activity.name}}
						</a>
					</div>
				</td>
				<td sda-data-type="int" style="text-align: center;"></td>
				<td style="text-align: center;" sda-exporter="rowData.criticality.label + ' (' + rowData.criticality.value + ')'">
					<div sd-activity-criticality sda-criticality="rowData.criticality"></div>
				</td>
				<td style="text-align: center;" sda-exporter="rowData.priority.label">
					<div ng-if = "!activityTableCtrl.priorityEditable" sd-process-priority sda-priority="rowData.priority" sda-editable="activityTableCtrl.priorityEditable"></div>
					<div ng-if = "activityTableCtrl.priorityEditable" sd-process-priority sda-priority="rowData.priority" sda-editable="activityTableCtrl.priorityEditable" 
					 sda-available-priorities ="activityTableCtrl.availablePriorities" 
					sda-on-change ="activityTableCtrl.registerNewPriority( rowData.oid, rowData.priority.value)"></div>
				</td>

				<td sda-exporter="activityTableCtrl.getDescriptorExportText(rowData.descriptorValues)">
					<table>
						<tr ng-repeat="desc in rowData.descriptorValues">
							<td ng-if ="!desc.isDocument" style="white-space: nowrap;">{{desc.key}}:</td>
							<td ng-if ="!desc.isDocument" style="white-space: nowrap;">{{desc.value}}</td>
						</tr>
					</table>
					<div sd-editor-template></div>
				</td>
				<td sda-field="start" sda-data-type="dateTime" style="text-align: center; white-space: nowrap;"></td>
				<td sda-field="lastModification" sda-data-type="dateTime" style="text-align: center; white-space: nowrap;"></td>
				<td sda-field="duration"></td>
				<td sda-field="lastPerformer" ></td>
				<td sda-field="processInstance.processName"></td>
				<td sda-field="status.label" ></td>
				<td sda-field="assignedTo"></td>
				<td ng-repeat="descCol in activityTableCtrl.descritorCols" sda-column="DESCRIPTOR_COLUMNS"
					 style="text-align: center; white-space: nowrap;"  sda-data-type="{{descCol.dataType}}" sda-exporter="activityTableCtrl.getDescriptorValueForExport( rowData.descriptorValues[colData.title])">
					<div sd-descriptor-content sda-value="rowData.descriptorValues[colData.title]" sda-data-type = "colData.dataType"> </div>
				</td>
				<td sda-column="TRIVIAL_DATA">
					<div
						ng-if="activityTableCtrl.activities.trivialManualActivities[rowData.oid]">
						<div sd-trivial-manual-activity-data
							sda-data-mappings="activityTableCtrl.activities.trivialManualActivities[rowData.oid].dataMappings"
							sda-out-data="activityTableCtrl.activities.trivialManualActivities[rowData.oid].inOutData"
							sda-on-change=activityTableCtrl.changeFormStatus(rowData.oid)></div>
					</div>
				</td>
				<td>
					<div style="text-align: right; white-space: nowrap;">
						<button ng-click="bpmCommon.stopEvent($event); activityTableCtrl.$openProcessHistory(rowData);"
							title="{{i18n('processportal.toolbars-workflowActions-tooltip-processContextExplorer')}}" class="button-link tbl-tool-link">
							<i class="glyphicon glyphicon-cog"></i>
						</button>
						<button ng-if="'activityOverview' === activityTableCtrl.mode " 	ng-click="bpmCommon.stopEvent($event); activityTableCtrl.$activateItem(rowData);"
							    ng-disabled="!rowData.activatable"	title="{{i18n('processportal.views-worklistPanel-tooltip-openActivity')}}" class="button-link tbl-tool-link">
							<i class="sc sc-gear-lightning" style="font-size : 15px;"></i>
						</button>
						<button sda-column="TRIVIAL_DATA" ng-if="'worklist' === activityTableCtrl.mode "
							ng-disabled="activityTableCtrl.activities.trivialManualActivities[rowData.oid] == undefined"
							ng-click="bpmCommon.stopEvent($event); activityTableCtrl.$openCompleteDialog(rowData);"
							title="{{i18n('processportal.toolbars-workflowActions-tooltip-complete')}}" class="button-link tbl-tool-link">
							<i class="glyphicon glyphicon-share-alt"></i>
						</button>
						<button ng-click="bpmCommon.stopEvent($event); activityTableCtrl.$openDelegateDialog(rowData);" ng-disabled="!rowData.delegable || row.defaultCaseActivity"
							title="{{i18n('processportal.toolbars-workflowActions-tooltip-delegate')}}" class="button-link tbl-tool-link">
							<i class="glyphicon glyphicon-user"></i>
						</button>
						<button ng-click="bpmCommon.stopEvent($event); activityTableCtrl.$openAbortDialog(rowData);" ng-disabled="!rowData.abortActivity || row.defaultCaseActivity"
							title="{{i18n('processportal.toolbars-workflowActions-tooltip-abort')}}" class="button-link tbl-tool-link">
							<i class="glyphicon glyphicon-remove"></i>
						</button>
						<button ng-if="'activityOverview' === activityTableCtrl.mode " sd-abort-popover ng-disabled="false" sda-activities="activityTableCtrl.dataTable.getSelection()" sda-on-confirm="activityTableCtrl.refresh()" class="button-link tbl-toolbar-item tbl-tool-link" style="padding-left: 0px;">
							<i class="glyphicon glyphicon-chevron-right glyphicon-rotate-90"></i>
						</button>
						<button ng-click="bpmCommon.stopEvent($event); activityTableCtrl.$openNotes(rowData);"
							title="{{i18n('processportal.toolbars-workflowActions-tooltip-notes')}}" class="button-link tbl-tool-link">
							<i class="glyphicon glyphicon-comment"></i>
						</button>
					</div>
				</td>
			</tr>
		</tbody>
	</table>

	<div sd-dialog 
		sda-show="activityTableCtrl.showCompleteDialog"
		sda-type="confirm" sda-title="{{i18n('processportal.views-completeActivityDialog-title')}}"
		sda-scope="this" sda-on-open="activityTableCtrl.$completeAll(res)" sda-confirm-action-label="Yes" sda-cancel-action-label="No"
		sda-template="plugins/html5-process-portal/scripts/directives/partials/completeActivityDialog.html">
	</div>

	<div sd-dialog
		sda-show="activityTableCtrl.showCompleteNotificationDialog"
		sda-type="alert" sda-title="{{activityTableCtrl.completeActivityResult.title}}"
		sda-scope="this" sda-cancel-action-label="{{i18n('views-common-messages.common-close')}}"
		sda-template="plugins/html5-process-portal/scripts/directives/partials/completeActivityNotfication.html">
	</div>
	
	<div sd-dialog
		sda-show="activityTableCtrl.updatePriorityNotification.visible"
		sda-type="custom" sda-title="{{i18n('views-common-messages.common-notification-title')}}"
		sda-scope="this" 
		sda-template="plugins/html5-process-portal/scripts/directives/partials/updatePriorityNotification.html">
	</div>
	

	<span sd-delegate-activity-dialog sda-show-dialog="activityTableCtrl.showDelegateDialog" sda-activity-list="activityTableCtrl.selectedActivity"
		sda-on-confirm="activityTableCtrl.onDelegateConfirm()">
	</span>

	<!--Dialog for abort Activity  -->
	<div sd-abort-activity-dialog sda-show-dialog="activityTableCtrl.showAbortActivityDialog" sda-on-abort-complete="activityTableCtrl.abortCompleted()" sda-activities-to-abort="activityTableCtrl.activitiesToAbort" ></div>
</div>
