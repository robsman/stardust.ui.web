<div class="process-list-wrapper ng-hide" ng-show="true">
	<div class="process-list-title tbl-title">{{processTableCtrl.title}}</div>
	<div sda-toolbar>
		<div class="tbl-toolbar-section">
			<!-- Abort process dialog -->
			<button ng-disabled="processTableCtrl.dataTable.getSelection() < 1" ng-click="processTableCtrl.openAbortDialog(processTableCtrl.dataTable.getSelection())" aid="PP-ProcessTable-AbortAll"
			  title="{{i18n('processportal.toolbars-workflowActions-tooltip-abort')}}" class="button-link tbl-toolbar-item tbl-tool-link tbl-tool-joined-link">
			   <i class="pi pi-abort pi-lg"></i>
			</button>
			
			<button class="button-link tbl-tool-link" ng-disabled="processTableCtrl.dataTable.getSelection() < 1" 
			  title="{{i18n('views-common-messages.views-abortProcess-menu-tooltip')}}" aid="PP-ProcessTable-AbortAllPopover"
				ng-click="processTableCtrl.openAbortPopover($event);">
				<i class="pi pi-menu-dropdown"></i>
			</button>
			
			<button ng-click="processTableCtrl.recoverProcess(this, processTableCtrl.dataTable.getSelection())" aid="PP-ProcessTable-RecoverAll"
			  title="{{i18n('views-common-messages.common-tooltip-recover')}}" 
				ng-disabled="processTableCtrl.dataTable.getSelection() < 1" class="button-link tbl-toolbar-item tbl-tool-link" style="padding-left: 0px;">
				 <div class="sc-badge">
				         <i class="pi pi-recover pi-lg" />
				  </div>
			</button>
			
			<span sd-popover ng-disabled="processTableCtrl.dataTable.getSelection() < 1" id="caseMenu" title="{{i18n('views-common-messages.views-case-tooltip-menu')}}" style="margin-left : -5px;">
               <div>
	                <i class="pi pi-case pi-lg"></i>
	                <i class="pi pi-bottom pi-menu-dropdown pi-sm" />
                </div>
				<div id="caseMenu" class="popover-body">
					<div>
						<button ng-disabled="processTableCtrl.dataTable.getSelection() < 1"  aid="PP-ProcessTable-AttachCase"
						    ng-click="processTableCtrl.openAttachToCaseDialog(processTableCtrl.dataTable.getSelection())" 
							title="{{i18n('views-common-messages.views-attachToCase-title')}}" class="button-link tbl-toolbar-item tbl-tool-link" style="margin-right: 0px;">
						   {{i18n('views-common-messages.views-createCase-menubar-attachToCase')}}
						</button>
					</div>
					<div>
						<button ng-disabled="processTableCtrl.dataTable.getSelection() < 1"  aid="PP-ProcessTable-CreateCase"
					     	ng-click="processTableCtrl.openCreateCaseDialog(processTableCtrl.dataTable.getSelection())" 
							title="{{i18n('views-common-messages.views-createCase-title')}}" class="button-link tbl-toolbar-item tbl-tool-link" style="margin-right: 0px;">
						   {{i18n('views-common-messages.views-createCase-menubar-createCase')}}
						</button>
					</div>
				</div>
			</span>
			
			<button ng-disabled="!processTableCtrl.isPriorityChanged();" ng-click="processTableCtrl.savePriorityChanges();" 
			        aid="PP-ProcessTable-SavePriority"
			        title="{{i18n('views-common-messages.common-tooltip-savePriorityChanges')}}"
				    class="button-link tbl-toolbar-item tbl-tool-link" style="padding-left: 0px;">
				<i class="pi pi-save pi-lg"></i>
			</button>
		</div>
	</div>

	<!-- Data table -->
	<table sd-data-table="{{processTableCtrl.tableHandleExpr}}" sd-data="processTableCtrl.fetchPage(params)" sda-ready="processTableCtrl.ready" 
		sda-page-size="{{processTableCtrl.sdaPageSize}}" sda-mode="remote"  aid="PP-ProcessTable-DataTable"
		sda-selectable="multiple" sda-initial-selection="{{processTableCtrl.initialSelection}}" sda-selection="{{processTableCtrl.selectionExpr}}"
		sda-column-selector="{{processTableCtrl.columnSelector}}" sda-preference-delegate="processTableCtrl.preferenceDelegate(prefInfo)"
		sda-sortable="true" sda-sort-by="processTableCtrl.initialSort"
		sda-exports="true" sda-exports-file-name="processTable-{{processTableCtrl.exportFileName}}">
		<thead sda-i18n-scope="views-common-messages.views-processTable-column">
			<tr>
				<th sda-name="processName" sda-sortable="true" sda-visible="{{processTableCtrl.isColumnVisible('processName')}}">
					<div sda-filter-template>
						<div sd-process-activity-table-filter sda-filter-type='process' sda-processes="processTableCtrl.fetchAllProcesses()"></div>
					</div>
				</th>
				<th sda-name="processOID" sda-field="oid" sda-label-key="pOID" sda-sortable="true" sda-filterable="true" sda-visible="{{processTableCtrl.isColumnVisible('processOID')}}"></th>
				<th sda-name="priority" sda-sortable="true" sda-visible="{{processTableCtrl.isColumnVisible('priority')}}">
					<div sda-filter-template>
						<div sd-priority-table-filter></div>
					</div>
				</th>
				<th sda-name="benchmark" sda-sortable="true" sda-visible="{{processTableCtrl.isColumnVisible('benchmark')}}">
				</th> 
				<th sda-name="descriptors" sda-visible="{{processTableCtrl.isColumnVisible('descriptors')}}"></th>
				<th sda-name="startingUser" sda-sortable="true" sda-visible="{{processTableCtrl.isColumnVisible('startingUser')}}">
					<div sda-filter-template>
						<div sd-user-table-filter></div>
					</div>
				</th>
				<th sda-name="startTime" sda-sortable="true" sda-filterable="true" sda-visible="{{processTableCtrl.isColumnVisible('startTime')}}"></th>
				<th sda-name="duration" sda-sortable="false" sda-visible="{{processTableCtrl.isColumnVisible('duration')}}"></th>
				
				<th sda-name="status" sda-sortable="false" sda-visible="{{processTableCtrl.isColumnVisible('status')}}">
					<div sda-filter-template>
						<div sd-multi-select-table-filter sda-options="processTableCtrl.availableStates"></div>
					</div>
				</th>
				
				<th sda-name="rootPOID" sda-field="processInstanceRootOID" sda-label-key="rootPOID" sda-sortable="true" sda-filterable="true"
					sda-visible="{{processTableCtrl.isColumnVisible('rootPOID')}}">
				</th>
				<th sda-name="endTime" sda-label-key="endTime"	sda-sortable="true" sda-filterable="true" 
					sda-visible="{{processTableCtrl.isColumnVisible('endTime')}}"></th>
					
				<th sda-name="caseOwner" sda-label="{{i18n('views-common-messages.overview-CaseOwner')}}" sda-sortable="false"
					sda-visible="{{processTableCtrl.isColumnVisible('caseOwner')}}">
				</th>
				<th ng-repeat="descCol in processTableCtrl.descritorCols"
					sda-name="{{descCol.id}}" sda-label="{{descCol.title}}"  sda-filterable="{{descCol.filterable}}" 
					sda-sortable="{{descCol.sortable}}" sda-visible="{{processTableCtrl.isColumnVisible(descCol.id)}}">
					<div sda-filter-template>
						<div ng-if="colData.dataType =='NUMBER'"><div sd-number-table-filter></div></div>
						<div ng-if="colData.dataType =='DATE'"><div sd-date-table-filter></div></div>
						<div ng-if="colData.dataType =='BOOLEAN'"><div sd-boolean-table-filter></div></div>
						<div ng-if="colData.dataType =='STRING'"><div sd-text-search-table-filter></div></div>
					</div>
				</th>
				
				<th sda-name="actions" sda-label="{{i18n('views-common-messages.views-common-column-actions')}}" sda-fixed="true" sda-exportable="false"></th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td sda-exporter="rowData.processName">
					<span class="spacing-right">
							<span title="{{i18n('business-control-center-messages.common-tooltip-process')}}"
								ng-if="!rowData.caseInstance && rowData.oid == rowData.processInstanceRootOID" >
								<i class="pi pi-badge-portrait pi-lg pi-activity pi-right">
		                   			 <i style="color:blue" class="pi pi-badge-bg pi-badge-bg-circle "></i>
		               			 </i>
							</span>
							<span src="plugins/views-common/images/icons/process.png"
								style="border: none;"
								title="{{i18n('business-control-center-messages.common-tooltip-subProcess')}}"
								ng-if="!rowData.caseInstance && rowData.oid != rowData.processInstanceRootOID" >
									<i class="pi pi-badge-portrait pi-lg pi-activity">
		               				 </i>
							</span>
							<span src="plugins/views-common/images/icons/envelope.png"
								style="border: none;"
								title="{{i18n('business-control-center-messages.common-tooltip-case')}}"
								ng-if="rowData.caseInstance" >
									<i class="pi pi-case pi-lg"></i>
							</span>
					</span>
					<a  href="#" aid="PP-ProcessTable-OpenProcessHistory"
						ng-click="bpmCommon.stopEvent($event); processTableCtrl.openProcessHistory(rowData);"
						class="button-link tbl-tool-link"> {{rowData.processName}}
					</a>
				</td>
				<td sda-data-type="int" sda-field="oid"></td>
				<td sda-data-type="int" style="width:110px;" sda-exporter="rowData.priority.label">
					<div sd-process-priority sda-priority="rowData.priority" sda-editable="true" 
					 sda-available-priorities ="processTableCtrl.availablePriorities" 
					 sda-on-change ="processTableCtrl.registerNewPriority( rowData.oid, rowData.priority.value)"
					 sda-value-changed="processTableCtrl.isPriorityChangedForRow(rowData.oid);">
					</div>
				</td>
				<td style="text-align: center;" sda-exporter="rowData.benchmark.label">
					<div sd-benchmark-category sda-value="rowData.benchmark"> </div>
				</td>
				<td sda-exporter="processTableCtrl.getDescriptorExportText(rowData.descriptorValues)">
					<table>
						<tr ng-repeat="desc in rowData.descriptorValues">
							<td ng-if ="!desc.isDocument" style="white-space: nowrap;">{{desc.key}}:</td>
							<td ng-if ="!desc.isDocument" style="white-space: normal;">{{desc.value}}</td>
						</tr>
					</table>
					<div sd-editor-template></div>
				</td>
				<td sda-field="startingUser"></td>
				<td sda-field="startTime" sda-data-type="dateTime"></td>
				<td sda-field="duration" style="text-align: center; white-space: nowrap;"></td>
				<td sda-field="status.label"></td>
				<td sda-field="processInstanceRootOID" sda-data-type="int"></td>
				<td sda-field="endTime" sda-data-type="dateTime"></td>
				<td sda-field="caseOwner" ></td>
				<td ng-repeat="descCol in processTableCtrl.descritorCols"
					 sda-data-type="{{descCol.dataType}}" sda-exporter="processTableCtrl.getDescriptorValueForExport( rowData.descriptorValues[colData.field])">
					<div sd-descriptor-content sda-value="rowData.descriptorValues[colData.field]" sda-data-type = "colData.dataType"> </div>
				</td>
				
				<td>
					<div style="text-align: right; white-space: nowrap;">
						<button ng-click="bpmCommon.stopEvent($event); processTableCtrl.openProcessHistory(rowData);" aid="PP-ProcessTable-OpenProcessHistoryAction"
							title="{{i18n('processportal.toolbars-workflowActions-tooltip-processContextExplorer')}}" class="button-link tbl-tool-link">
							<i class="pi pi-process pi-lg"></i>
						</button>
						
						<button ng-click="bpmCommon.stopEvent($event); processTableCtrl.openAbortDialog(rowData);"
						    ng-disabled="!rowData.enableTerminate"  aid="PP-ProcessTable-AbortAction"
							title="{{i18n('processportal.toolbars-workflowActions-tooltip-abort')}}" class="button-link tbl-tool-link tbl-tool-joined-link">
							<i class="pi pi-process-abort pi-lg" ></i>
						</button>
						
						<!-- abort menu -->
						<button class="button-link tbl-tool-link" ng-disabled="!rowData.enableTerminate"  aid="PP-ProcessTable-AbortPopoverAction"
						    title="{{i18n('views-common-messages.views-abortProcess-menu-tooltip')}}"
							ng-click="processTableCtrl.openAbortPopover($event, rowData); bpmCommon.stopEvent($event);">
							<i class="pi pi-menu-dropdown"></i>
						</button>
						
						<button ng-click="processTableCtrl.recoverProcess(this, rowData)" aid="PP-ProcessTable-RecoverAction"
						    title="{{i18n('views-common-messages.common-tooltip-recover')}}" 
							ng-disabled="!rowData.enableRecover" class="button-link tbl-toolbar-item tbl-tool-link" style="padding-left: 0px;">
				            <div class="sc-badge">
				                <i class="pi pi-recover pi-lg"></i>
				            </div>
						</button>
						
						<!-- View chart -->
						<button class="button-link tbl-tool-link"   aid="PP-ProcessTable-OpenGrantChart"
							title="{{i18n('business-control-center-messages.views-processSearchView-tooltip-viewGanttChart')}}"
							ng-click="processTableCtrl.openChart(rowData); bpmCommon.stopEvent($event);">
							<i class="pi pi-gantt-chart pi-lg" ></i>
						</button>
						
						<button ng-click="bpmCommon.stopEvent($event); processTableCtrl.openNotes(rowData);"
						    aid="PP-ProcessTable-OpenNotes"
							title="{{i18n('processportal.toolbars-workflowActions-tooltip-notes')}}" class="button-link tbl-tool-link">
							<i class="pi pi-notes-empty pi-lg" ng-if ="rowData.notesCount === 0" ></i>
							<i class="pi pi-notes pi-lg" ng-if ="rowData.notesCount > 0" ></i>
						</button>

						<button ng-click="processTableCtrl.openProcessDocumentsPopover(rowData, $event);" aid="PP-ProcessTable-OpenProcessDocuments"
							title="{{i18n('processportal.toolbars-workflowActions-tooltip-processDocuments')}}" class="button-link tbl-tool-link">
							<i class="pi pi-process-documents pi-lg"></i>
						</button>
					</div>
				</td>
			</tr>
		</tbody>
	</table>
	
	<!--Dialog for abort process  -->
	<div sd-abort-process-dialog sda-show-dialog="processTableCtrl.showAbortProcessDialog" sda-on-abort-complete="processTableCtrl.abortCompleted()"
	     sda-processes-to-abort="processTableCtrl.processesToAbort" >
	</div>
	
	<span sd-popover="processTableCtrl.popoverDirective" id="abortMenu">
		<div class="popover-body">
			<div>
				<button ng-disabled="processTableCtrl.processesToAbort.length < 1" ng-click="processTableCtrl.openSwitchDialog()" aid="PP-ProcessTable-AbortAndStart"
					class="button-link tbl-toolbar-item tbl-tool-link" style="margin-right: 0px;">
				   {{i18n('views-common-messages.views-switchProcessDialog-Menu-abortandstart')}}
				</button>
			</div>
			<div>
				<button ng-disabled="processTableCtrl.processesToAbort.length != 1" ng-click="processTableCtrl.openJoinDialog()" aid="PP-ProcessTable-AbortAndJoin"
					class="button-link tbl-toolbar-item tbl-tool-link" style="margin-right: 0px;">
				   {{i18n('views-common-messages.views-switchProcessDialog-Menu-abortandjoin')}}
				</button>
			</div>
		</div>
	</span> <span sd-popover="processTableCtrl.documentPopoverHandle"
		id="processDocuments">
		<div class="popover-body" style="text-align: left; min-width: 100px;">
			<div ng-show="processTableCtrl.processPopover.data.contentLoaded">
				<div ng-if="processTableCtrl.processPopover.data.supportsProcessAttachments">
					<div class="popoverHeading">
						<b>{{i18n('processportal.toolbars-workflowActions-processDocuments-processAttachments')}}</b>
					</div>
					<div ng-show="processTableCtrl.processPopover.data.processAttachments.documents.length > 0">
						<div ng-repeat="doc in processTableCtrl.processPopover.data.processAttachments.documents">
							<a href="#"
								ng-click="processTableCtrl.openDocumentsView(doc.uuid)">{{doc.name}}</a>
						</div>
					</div>
					<div ng-hide="processTableCtrl.processPopover.data.processAttachments.documents.length > 0">
						{{i18n('processportal.toolbars-workflowActions-processDocuments-noProcessAttachments')}}
					</div>
				</div>
				<div ng-if="processTableCtrl.processPopover.data.specificDocuments.length > 0">
					<div class="popoverHeading">
						<b>{{i18n('processportal.toolbars-workflowActions-processDocuments-specificDocuments')}}</b>
					</div>
					<div ng-repeat="map in processTableCtrl.processPopover.data.specificDocuments">
						<div ng-if="map.documents.length > 0">
							<a ng-repeat="doc in map.documents" href="#"
								ng-click="processTableCtrl.openDocumentsView(doc.uuid)">{{map.dataPath.name}}</a>
						</div>
						<div ng-if="map.documents.length < 1">
							<span>&lt{{map.dataPath.name}}&gt</span>
						</div>
					</div>
				</div>
				<div
					ng-if="processTableCtrl.processPopover.data.processAttachments.documents.length > 0 || processTableCtrl.processPopover.data.specificDocuments.documents.length > 0">
					<a href="#"
						ng-click="processTableCtrl.openAllProcessDocumentViews(processTableCtrl.processPopover.data)"><B>{{i18n('processportal.toolbars-workflowActions-processDocuments-openAllDocuments')}}</B></a>
				</div>
				<div
					ng-if="!processTableCtrl.processPopover.data.supportsProcessAttachments && processTableCtrl.processPopover.data.specificDocuments.length == 0">
					{{i18n('processportal.toolbars-workflowActions-processDocuments-noProcessDocuments')}}
				</div>
			</div>
			<div ng-hide="processTableCtrl.processPopover.data.contentLoaded">
				{{i18n('views-common-messages.common-loading')}}</div>
		</div>
	</span>

	<div sd-join-process-dialog sda-show-dialog="processTableCtrl.showJoinProcessDialog" sda-on-confirm="processTableCtrl.joinCompleted"
	     sda-process-instances="processTableCtrl.processesToAbort" >
	</div>
	
	<div sd-switch-process-dialog sda-show-dialog="processTableCtrl.showSwitchProcessDialog" sda-on-confirm="processTableCtrl.switchCompleted"
	     sda-process-instances="processTableCtrl.processesToAbort" >
	</div>
	
	<div sd-attach-to-case-dialog sda-show-dialog="processTableCtrl.showAttachToCaseDialog" sda-on-confirm="processTableCtrl.attachToCaseCompleted"
	     sda-process-instances="processTableCtrl.processesToAttachCase" >
	</div>
	
	<div sd-create-case-dialog sda-show-dialog="processTableCtrl.showCreateCaseDialog" sda-on-confirm="processTableCtrl.createCaseCompleted"
	     sda-process-instances="processTableCtrl.processesToCreateCase" >
	</div>
</div>
