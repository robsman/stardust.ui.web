<!doctype html>
<html ng-app="modelPopupApp">
<head>
<script src="../js/libs/angular/angular-1.0.2.js"></script>
<script>
	var app = angular.module('modelPopupApp', []);

	app.controller('modelPopupController', [
			'$scope',
			function($scope) {
				$scope.i18n = payloadObj.i18n;

				$scope.ok = function() {
					if ($scope.modelIDDuplicate || !$scope.modelId || !$scope.modelName) {
						return;
					}

					payloadObj.acceptFunction({
						modelId : $scope.modelId,
						modelName : $scope.modelName
					});

					closePopup();
				};

				$scope.cancel = function() {
					closePopup();
				};

				$scope.$watch('modelName', function(newVal, oldVal, scope) {
					//prepare id
					var id = payloadObj.m_utils.generateID(newVal, payloadObj.models, "id");
					$scope.modelId = id;
				});

				$scope.$watch('modelId', function(newVal, oldVal, scope) {
					//prepare id
					$scope.modelIDDuplicate = false;
					var id = payloadObj.m_utils.generateID(newVal,
							payloadObj.models, "id", null, true);
					if (id == "duplicate") {
						$scope.modelIDDuplicate = true;
					}
				});

			} ]);
</script>
<link type="text/css" rel="stylesheet"
	href="../../common/css/iPopupDialogStyle.css">
</head>
<body ng-controller="modelPopupController"
	style="height: 100%; width: 100%; overflow: hidden; margin: 0px;">

	<form name="modelPopupForm">

		<div id="titleBar" class="iPopupDialogTitleBar">
			<span id="titleText" class="iPopupDialogTitleText">{{i18n.getProperty("modeler.messages.createmodel")}}</span>
			<input id="dialogCloseIcon" type="button" title={{i18n.getProperty(
				"modeler.messages.confirm.close")}}
				class="iPopupDialogCloseControl"
				ng-click="cancel()" />
		</div>

		<div id="contentArea" class="iPopupDialogContentArea">
			<div class="iPopupDialogSpacerDiv"></div>
			<table border="0">
				<tr class="iPopupDialogContentText">
					<td>{{i18n.getProperty("modeler.propertyView.modelView.name")}}</td>
					<td><input ng-model="modelName" name="modelName" type="text"
						required></input></td>
					<td>
						<div class="iPopupDialogError"
							ng-show="modelPopupForm.modelName.$error.required">
							{{i18n.getProperty("modeler.messages.modelPopup.name.required")}}</div>
					</td>
				</tr>
				<tr class="iPopupDialogContentText">
					<td>{{i18n.getProperty("modeler.propertyView.modelView.id")}}</td>
					<td><input ng-model="modelId" name="modelId" type="text"
						required></input></td>
					<td>
						<div class="iPopupDialogError"
							ng-show="modelPopupForm.modelId.$error.required">
							{{i18n.getProperty("modeler.messages.modelPopup.id.required")}}</div>
						<div class="iPopupDialogError" ng-show="modelIDDuplicate">
							{{i18n.getProperty("modeler.messages.modelPopup.id.unique")}}</div>
					</td>
				</tr>
			</table>
		</div>

		<div id="controlsBar" class="iPopupDialogControlsArea">
			<input id="acceptButton" type="button" value={{i18n.getProperty('modeler.messages.confirm.ok')}}
				class="iPopupDialogControlButton"
				ng-click="ok()" /> <input id="cancelButton" type="button"
				value={{i18n.getProperty('modeler.messages.confirm.cancel')}}
				class="iPopupDialogControlButton"
				ng-click="cancel()" />
		</div>

	</form>
</body>
</html>