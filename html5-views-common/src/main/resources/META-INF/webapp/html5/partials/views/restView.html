<!DOCTYPE html>
<html>
<head>
<title>PORTAL REST</title>

<style>
.confluenceTh {
	font-weight: bold;
	background-color: #f0f0f0
}

.path {
	font-size: 20px;
	color: #b14040;
}

.moduleName {
	color: #b14040;
	font-size: 20px;
}

h1, h2, h3, h4, .moduleName, .tablesorter-header-inner {
	color: #b14040;
}

.endpointUrl {
	font-size: 12px;
	text-decoration: underline;
}

.formattedData {
	font-size: 12px;
}

.get, .put, .post, .delete {
	color: white;
}

.get {
	background-color: #0f6ab4
}

.post {
	background-color: #10a54a
}

.put {
	background-color: #c5862b;
}

.delete {
	background-color: #a41e22;
}

.confluenceTh, .confluenceTd {
	border: 1px solid #ddd;
	vertical-align: top;
	text-align: left;
}
</style>

<script
	src="../../../../../portal-shell/js/libs/angular/1.2.11/angular.js"></script>
<script
	src="../../../../../portal-shell/js/libs/angular/1.2.11/angular-resource.min.js"></script>
<script type="text/javascript">
  (function() {

    function getBaseUrl() {
      // When loaded from framework i.e index.html, location.href points
      // to contextRoot
      var baseURL = '';
      if (location.href.indexOf("plugins") > -1) {
        // If plugins encountered in the location url 
        baseURL = location.href.substring(0, location.href.indexOf("plugins"));
      }
      return baseURL;
    }

    var app = angular.module('restViewApp', ['ngResource']);

    app.controller('Controller', ['$scope', '$resource', function($scope, $resource) {
      var REST_BASE_URL = getBaseUrl() + "services/rest/portal/portal-rest";
      var restResource = $resource(REST_BASE_URL);

      restResource.get().$promise.then(function(responseData) {
        //initialize expand-collapse feature
        $scope.modules = {};
        $scope.modulesPanel = {};
        $scope.resourcesPanel = {};
        for ( var moduleName in responseData) {
          if (moduleName.indexOf('$') != 0) {
            $scope.modules[moduleName] = responseData[moduleName];
            $scope.modulesPanel[moduleName] = false;
            for ( var resourceName in responseData[moduleName]) {
              $scope.resourcesPanel[resourceName] = false;
            }
          }
        }
      }, function(error) {
        alert("something went wrong");
      })

      $scope.expandAll = function(moduleName) {
        $scope.modulesPanel[moduleName] = true;
        for ( var resourceName in $scope.modules[moduleName]) {
          $scope.resourcesPanel[resourceName] = true;
        }
      }

      $scope.collapseAll = function(moduleName) {
        for ( var resourceName in $scope.modules[moduleName]) {
          $scope.resourcesPanel[resourceName] = false;
        }
      }
    }]);

  })();
</script>


</head>
<body ng-app="restViewApp">
	<div class="wiki-content" ng-controller="Controller"
		id="resources_container">
		<h1>List of All Endpoints</h1>
		<ul>
			<li ng-repeat="(moduleName, moduleValue) in modules"><span
				ng-click="modulesPanel[moduleName] = !modulesPanel[moduleName]">
					<a href="#{{moduleName}}" class="moduleName">{{moduleName}}</a>
			</span>
				<button ng-show="modulesPanel[moduleName]" type="button"
					ng-click="expandAll(moduleName)">Expand All</button>
				<button ng-show="modulesPanel[moduleName]" type="button"
					ng-click="collapseAll(moduleName)">Collapse All</button>
				<ul ng-show="modulesPanel[moduleName]">
					<li ng-repeat="(resourceName, resourceValue) in moduleValue"
						ng-click="resourcesPanel[resourceName] = !resourcesPanel[resourceName]"><span>
							<a href="#{{resourceName}}">{{resourceName}}
								({{resourceValue.basePath}})</a>
					</span>
						<ul ng-show="resourcesPanel[resourceName]">
							<li ng-repeat="endpoint in resourceValue.endpoints"><span>
									<a href="#{{endpoint.method}}"><span
										ng-class="endpoint.httpMethod | lowercase"
										style="font-size: 10px">{{endpoint.httpMethod}} </span>
										{{endpoint.path}}</a>
							</span></li>
						</ul></li>
				</ul></li>
		</ul>


		<div ng-repeat="(moduleName, moduleValue) in modules">
			<div ng-repeat="(resourceName, resourceValue) in moduleValue">
				<h2 id="">
					<strong>{{resourceValue.basePath}} </strong>
				</h2>
				<div ng-show="resourceValue.description">
					<strong>Description:</strong> <span>{{resourceValue.description}}</span>
				</div>
				<p>
					<strong>Package:</strong>
					<code>{{resourceValue.qualifiedName}}</code>
				</p>
				<div>
					<table>
						<thead>
							<tr class="tablesorter-headerRow">
								<th class="confluenceTh sortableHeader" data-column="1"
									tabindex="0" unselectable="on"
									style="min-width: 0px; max-width: none;"><div
										class="tablesorter-header-inner">HTTP Method</div></th>
								<th class="confluenceTh sortableHeader" data-column="0"
									tabindex="0" unselectable="on"
									style="min-width: 0px; max-width: none;"><div
										class="tablesorter-header-inner">Path</div></th>
								<th class="confluenceTh sortableHeader" data-column="2"
									tabindex="0" unselectable="on"
									style="min-width: 0px; max-width: none;"><div
										class="tablesorter-header-inner">Path Params</div></th>
								<th class="confluenceTh sortableHeader" data-column="3"
									tabindex="0" unselectable="on"
									style="min-width: 0px; max-width: none;"><div
										class="tablesorter-header-inner">Query Params</div></th>
								<th class="confluenceTh sortableHeader" data-column="4"
									tabindex="0" unselectable="on"
									style="min-width: 0px; max-width: none;"><div
										class="tablesorter-header-inner">Request Description</div></th>
								<th class="confluenceTh sortableHeader" data-column="5"
									tabindex="0" unselectable="on"
									style="min-width: 0px; max-width: none;"><div
										class="tablesorter-header-inner">Response Description</div></th>
								<th class="confluenceTh sortableHeader" data-column="6"
									tabindex="0" unselectable="on"
									style="min-width: 0px; max-width: none;"><div
										class="tablesorter-header-inner">Description</div></th>
							</tr>
						</thead>
						<tbody>
							<tr ng-repeat="endpoint in resourceValue.endpoints">
								<td class="confluenceTd"><span
									ng-class="endpoint.httpMethod | lowercase">{{endpoint.httpMethod}}
								</span></td>
								<td class="confluenceTd path"><span
									id="{{endpoint.method}}">&nbsp;{{endpoint.path}}</span> <br>
									<span class="endpointUrl"><a target="_blank" href="{{endpoint.relativePath}}">{{endpoint.uri}}</a></span></td>
								<td class="confluenceTd"><ul>
										<li ng-repeat="(paramName, paramValue) in endpoint.pathParams">
											<span>{{paramName}}: </span> <span>
												{{paramValue.javaType}}</span>
										</li>
									</ul></td>
								<td class="confluenceTd"><ul>
										<li
											ng-repeat="(paramName, paramValue) in endpoint.queryParams">
											<span>{{paramName}}: </span> <span>
												{{paramValue.javaType}}</span>
										</li>
									</ul></td>
								<td class="confluenceTd"><pre class="formattedData">{{endpoint.requestDescription}}</pre>
								</td>
								<td class="confluenceTd"><pre class="formattedData">{{endpoint.responseDescription}}</pre>
								</td>
								<td class="confluenceTd"><pre class="formattedData">{{endpoint.description}}</pre></td>
							</tr>

						</tbody>
					</table>

				</div>
			</div>
		</div>

	</div>

</body>
</html>